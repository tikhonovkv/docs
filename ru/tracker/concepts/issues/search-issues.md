---
sourcePath: ru/tracker/api-ref/concepts/issues/search-issues.md
---
# Найти задачи

Запрос позволяет получить список задач, удовлетворяющих заданному критерию. 

Если количество строк в ответе менее 10000, используйте [постраничное отображение результатов](../../common-format.md#displaying-results).

Если количество строк в ответе более 10000, используйте [механизм прокрутки результатов](#scroll).

## Формат запроса {#section_rnm_x4j_p1b}

Перед выполнением запроса [получите доступ к API](../access.md).

Для поиска задач используйте HTTP-запрос с методом `POST`. Тело запроса содержит критерии для поиска.

```json
POST /v2/issues/_search?expand=transitions
Host: {{ host }}
Authorization: OAuth <OAuth-токен>
{{ org-id }}

{
   "filter": {
      "<имя_поля>": "<значение_в_поле>"
   },
   "order":"+<ключ_поля>"
}
```

{% include [headings](../../../_includes/tracker/api/headings.md) %}

{% cut "Параметры запроса" %}

**Дополнительные параметры**

Параметр | Описание | Тип данных
----- | ----- | -----
expand |  Дополнительные поля, которые будут включены в ответ: <ul><li>`transitions` — переходы по жизненному циклу;</li><li>`attachments` — вложения.</li><li>`links` — связи.</li></ul> | Строка
perPage | Количество задач на странице ответа. Значение по умолчанию — 50. Дополнительные параметры показа ответа можно настроить с помощью  механизма [постраничного отображения](../../common-format.md#displaying-results). | Число

{% endcut %}

{% cut "Параметры тела запроса" %}

Для получения списка задач, укажите один из следующих параметров:

Параметр | Описание | Формат
----- | ----- | -----
queue | Очередь. | Строка
keys | Список ключей задач. | Строка или Массив строк
filter | Параметры фильтрации задач. В параметре можно указать название любого поля и значение, по которому будет производиться фильтрация. | Объект
query | Фильтр на [языке запросов](../../user/query-filter.md). | Строка

{% note info %}

Запрос не подразумевает комбинирование параметров.

При использовании комбинации двух параметров, в ответе будет возвращен результат по параметру с более высоким приоритетом.
Приоритеты параметров (в порядке убывания): 
1. `queue`;
1. `keys`;
1. `filter`;
1. `query`.

При использовании комбинации трех или четырех параметров, ответ будет содержать код 400 с сообщением `Вы можете использовать только ключи, очередь или поисковый запрос.`

{% endnote %}


**Дополнительные параметры**

Параметр | Описание | Формат
----- | ----- | -----
order | Направление и поле сортировки задач (только в комбинации с параметром `filter`). <br/>Значение указывается в формате `[+/-]<ключ_поля>`. Знак `+` или `-` обозначает направление сортировки. | Строка 

{% note info %}

При использовании параметра `query` указывайте способ сортировки с помощью [языка запросов](../../user/query-filter.md).
Ответ на запрос с параметром `queue` сортируется по ключу задачи, а с параметром `keys` — по названиям задач в алфавитном порядке.

{% endnote %}

{% endcut %}

> Пример 1: Запрос списка задач с помощью фильтра:
> 
> - Используется HTTP-метод POST.
> - В ответе включено отображение вложений.
> - Ответ должен содержать только задачи из очереди «TREK», в которых не указан исполнитель.
> - Результаты отсортированы по статусу в возрастающем порядке.
> 
> ```
> POST /v2/issues/_search?expand=attachments HTTP/1.1
> Host: {{ host }}
> Authorization: OAuth <OAuth-токен>
> {{ org-id }}
> 
> {
>   "filter": {
>     "queue": "TREK",
>     "assignee": "Empty()"
>   },
>   "order":"+staus"
> }
> ```

> Пример 2: Запрос списка задач с помощью языка запросов:
> 
> - Используется HTTP-метод POST.
> - Ответ должен содержать только задачи из очереди «TREK», которые не являются эпиками.
> - Результаты отсортированы по дате обновления в убывающем порядке.
> 
> ```
> POST /v2/issues/_search?expand=attachments HTTP/1.1
> Host: {{ host }}
> Authorization: OAuth <OAuth-токен>
> {{ org-id }}
> 
> {
>   "query": "epic: notEmpty() Queue: TREK \"Sort by\": Updated DESC",
> }
> ```

## Формат ответа {#section_xc3_53j_p1b}

{% list tabs %}

- Запрос выполнен успешно

    {% include [answer-200](../../../_includes/tracker/api/answer-200.md) %}

    Тело ответа содержит результаты в формате JSON.

    {% include [answer-issue](../../../_includes/tracker/api/answer-issue.md) %}

- Запрос выполнен с ошибкой

    Если запрос не был успешно обработан, API возвращает ответ с кодом ошибки:

    {% include [answer-error-400](../../../_includes/tracker/api/answer-error-400.md) %}

    {% include [answer-error-401](../../../_includes/tracker/api/answer-error-401.md) %}

    {% include [answer-error-403](../../../_includes/tracker/api/answer-error-403.md) %}

    {% include [answer-error-404](../../../_includes/tracker/api/answer-error-404.md) %}

{% endlist %}

## Прокрутка результатов поиска {#scroll}

Если ответ на запрос поиска задач содержит более 10000 строк, рекомендуем использовать механизм прокрутки результатов.

При использовании механизма прокрутки в ответ на запрос возвращается страница с результатами поиска и идентификатором для получения следующей страницы. 

Результаты поиска можно отобразить в отсортированном виде или в произвольном порядке. Чтобы уменьшить количество затрачиваемых ресурсов при поиске большого количества задач, используйте механизм прокрутки без сортировки.

{% note info %}

Прокрутка результатов поиска требует больше ресурсов по сравнению с [постраничным отображением результатов](../../common-format.md#displaying-results).

{% endnote %}

### Параметры запроса с прокруткой {#scroll-params}

- **scrollType**

    Тип прокрутки. Допустимые значения:

    - `sorted` — используется указанная в запросе сортировка;
    - `unsorted` — сортировка не используется.

    Данный параметр используется только в первом из серии запросов прокрутки. 

    Данный параметр не используется совместно с параметрами поиска `keys` или `queue`. При использовании прокрутки и этих параметров ответ будет содержать код 400 и сообщение `Прокрутка результатов не поддерживается`. Чтобы найти задачи очереди, используйте параметры `filter` или `query`.

- **perScroll**

    Максимальное количество задач в ответе. Значение по умолчанию — 100, максимально допустимое значение — 1000.

    Данный параметр используется только в первом из серии запросов прокрутки. 

- **scrollTTLMillis (необязательный параметр)**

    Время жизни контекста прокрутки в миллисекундах. Значение по умолчанию — 60000.

- **scrollId**

    Идентификатор страницы. 

    Данный параметр указывается во втором и следующих запросах серии прокрутки. Значение параметра должно быть получено из заголовка `X-Scroll-Id`, который возвращается в ответе на предыдущий запрос серии.


### Ответ на запрос с прокруткой {#scroll-response}

При использовании прокрутки создается слепок результатов поиска. Переключение между страницами результатов осуществляется в рамках данного слепка. Таким образом, если какая-либо задача будет изменена и перестанет отвечать требованиям поискового запроса, это не повлияет на отображение задачи в слепке результатов поиска. 

Слепок результатов поиска сохраняется, пока не будут просмотрены все страницы. Если вы не хотите загружать все результаты поиска, освободите занятые ресурсы с помощью запроса [{#T}](search-release.md).

Ответ содержит заголовки:

- **Link**

    Ссылка для перехода на следующую страницу результатов поиска. Ссылку можно использовать только для перехода к следующей и к первой страницам.

- **X-Scroll-Id**

    Идентификатор страницы.

- **X-Scroll-Token**

    Токен, удостоверяющий принадлежность запроса текущему пользователю. 

- **X-Total-Count**

    Общее число записей в ответе.

### Пример {#scroll-example}

Рассмотрим получение результатов поиска с использованием прокрутки на примере: найти все задачи, которые назначены на сотрудника. 

Условия запроса:
- Используется HTTP-метод `GET`.
- Ключ очереди — «TREK».
- Исполнитель задачи — <логин_пользователя>.
- Результаты поиска должны быть отсортированы.

Последовательность выполнения серии запросов:

1. Создайте первый запрос серии с параметрами:
    - `scrollType=sorted`
    - `perScroll=100`
    - `scrollTTLMillis=10000` 

    Пример:
    ```json
    POST /v2/issues/_search?scrollType=sorted&perScroll=100&scrollTTLMillis=10000
    Host: {{ host }}
    Authorization: OAuth <OAuth-токен>
    {{ org-id }}

    {
      "filter": {
        "queue": "TREK",
        "assignee": "<логин_пользователя>"
      }
    }
    ```

    Ответ на запрос будет содержать список задач и заголовки:
    - `Link` — ссылки на первую и следующую страницы результатов:  

       ```
       Link: <https://{{ host }}/v2/issues/_search?expand=&embed=&fields=&staleOk=false&scrollType=sorted&scrollTTLMillis=10000&perScroll=2000>; rel="first"
       Link: <https://{{ host }}/v2/issues/_search?expand=&embed=&fields=&staleOk=false&scrollTTLMillis=10000&scrollId=6554d4cbbda0de18********&scrollToken=dummy-token-you-dont-have-to-specify-it>; rel="next"
       ```

       Используйте ссылку из заголовка с параметром `rel="next"` для получения следующей страницы результатов.

    - `X-Total-Count` — общее количество задач в выдаче.
    
    Если запрошенная страница не является последней, также возвращаются заголовки:
    - `X-Scroll-Id`. Значение используется в параметре `scrollId` для получения следующей страницы результатов.
    - `X-Scroll-Token`. Значение не используется в текущей версии API {{ ver }}.

1. Создайте второй запрос серии с параметрами `scrollId` и `scrollToken`, полученными на предыдущем шаге.
    
    Пример:
    ```json
    POST /{{ ver }}/issues/_search?scrollId=cXVlcnlU<...>&scrollTTLMillis=10000
    Host: {{ host }}
    Authorization: OAuth <OAuth-токен>
    {{ org-id }}

    {
      "filter": {
        "queue": "TREK",
        "assignee": "<логин_пользователя>"
      }
    }
    ```
    
    На запрос будет получен ответ со следующей страницей списка задач и очередными значениями `X-Scroll-Id` и `X-Scroll-Token`, если страница не окажется последней. 

1. Продолжайте отправлять запросы на получение следующей страницы результатов до тех пор, пока не получите все задачи из выдачи. 
